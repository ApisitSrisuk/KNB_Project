<!doctype html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <title>ใบสำคัญการซื้อขาย</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Sarabun:wght@200;300;400;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- html2pdf -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
      @page {
        size: A4;
        margin: 10mm;
      }
      * {
        font-family: "Sarabun", Arial, sans-serif;
      }
      body {
        background: #f0f2f5;
        padding: 0;
        margin: 0;
        -webkit-print-color-adjust: exact;
      }

      .invoice-box {
        background: #fff;
        margin: 0 auto;
        padding: 16mm;
        color: #222;
        font-size: 14px;
        max-width: 210mm;
      }

      .header {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;
      }

      .company-info {
        line-height: 1.6;
        text-align: left;
        flex: 1;
      }

      .company-info h2 {
        margin: 0;
        color: #0b3b66;
      }

      .logo {
        margin-bottom: 15px;
      }

      .logo img {
        max-width: 200px;
      }

      .title {
        text-align: center;
        font-size: 22px;
        margin: 20px 0;
        font-weight: 700;
        color: #0b3b66;
        border-bottom: 2px solid #0b3b66;
        padding-bottom: 10px;
      }

      .info-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
      }

      .info-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .info-item {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .info-item strong {
        min-width: 100px;
        white-space: nowrap;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        font-size: 13px;
      }

      table,
      th,
      td {
        border: 1px solid #d7dbe0;
      }

      th {
        background: #f6f8fa;
        color: #233444;
        padding: 10px;
        font-weight: 600;
        text-align: center;
      }

      td {
        padding: 10px;
        vertical-align: middle;
      }

      .text-right {
        text-align: right;
      }
      .text-center {
        text-align: center;
      }

      .summary-container {
        display: flex;
        justify-content: flex-end;
        margin-top: 20px;
      }

      .summary-table {
        width: 300px;
        border: none;
      }

      .summary-table td {
        border: none;
        padding: 5px 10px;
      }

      .payment-section {
        margin-top: 20px;
        padding: 15px;
        background: #f8fbff;
        border: 1px solid #e3eefc;
        border-radius: 8px;
      }

      .payment-methods {
        display: flex;
        gap: 20px;
        margin-bottom: 10px;
      }

      .payment-details {
        display: none;
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px dashed #ccc;
      }

      .payment-details.active {
        display: block;
      }

      .payment-row {
        display: flex;
        gap: 15px;
        align-items: center;
        margin-bottom: 8px;
      }

      .payment-row label {
        min-width: 80px;
      }

      .footer {
        margin-top: 50px;
        display: flex;
        justify-content: space-between;
        text-align: center;
      }

      .signature {
        width: 25%;
      }

      .signature-line {
        margin-top: 40px;
        border-top: 1px solid #333;
        padding-top: 5px;
      }

      .btn-container {
        text-align: center;
        margin-bottom: 20px;
      }

      .btn {
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
        border-radius: 6px;
        border: none;
        background: #1e88e5;
        color: #fff;
        margin: 0 5px;
        transition: background 0.3s;
      }

      .btn:hover {
        background: #1565c0;
      }
      .btn.secondary {
        background: #6c757d;
      }
      .btn.secondary:hover {
        background: #5a6268;
      }

      input[type="text"],
      input[type="number"],
      input[type="date"],
      textarea,
      .dropdownS {
        padding: 6px 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        width: 100%;
        box-sizing: border-box;
        font-family: "Sarabun", sans-serif;
      }

      input[type="radio"] {
        width: auto;
        margin-right: 5px;
      }

      .no-print {
        display: block;
      }

      @media print {
        .no-print {
          display: none !important;
        }
        body {
          background: #fff;
          padding: 0;
        }
        .invoice-box {
          padding: 0;
          border: none;
        }
        .payment-section {
          background: transparent;
          border: 1px solid #eee;
        }
      }

      /* PDF Export specific styles */
      .export-mode input,
      .export-mode select,
      .export-mode textarea {
        border: none !important;
        background: transparent !important;
        padding: 0 !important;
        resize: none;
      }
      .export-mode .no-export {
        display: none !important;
      }
      .export-mode .payment-methods {
        display: none !important;
      }
      .export-mode .payment-details {
        display: none !important;
      }
      .export-mode .payment-details.active {
        display: block !important;
        border-top: none !important;
      }
      .export-mode .info-section {
        grid-template-columns: 1fr 1fr !important;
        gap: 10px !important;
      }
      .export-mode .info-group {
        gap: 4px !important;
      }
      .export-mode .info-item {
        gap: 4px !important;
        line-height: 1.3 !important;
        font-size: 12px !important;
      }
      .export-mode .info-item strong {
        min-width: 85px !important;
        font-size: 12px !important;
      }
      .export-mode textarea {
        height: auto !important;
        max-height: 40px !important;
        overflow: hidden !important;
        line-height: 1.2 !important;
        font-size: 10px !important;
      }
      .export-mode input[type="text"],
      .export-mode input[type="date"] {
        font-size: 12px !important;
        line-height: 1.2 !important;
      }

      /* Navbar styles */
      .navbar {
        background: linear-gradient(135deg, #0b3b66 0%, #1565c0 100%);
        padding: 0;
        margin: 0;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 1000;
      }
      .navbar-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 20px;
        max-width: 1200px;
        margin: 0 auto;
      }
      .navbar-brand {
        color: #fff;
        font-size: 18px;
        font-weight: 700;
        text-decoration: none;
      }
      .navbar-menu {
        display: flex;
        gap: 20px;
        list-style: none;
        margin: 0;
        padding: 0;
      }
      .navbar-menu a {
        color: #fff;
        text-decoration: none;
        font-size: 14px;
        padding: 6px 12px;
        border-radius: 4px;
        transition: background 0.3s;
      }
      .navbar-menu a:hover {
        background: rgba(255, 255, 255, 0.2);
      }
      @media print {
        .navbar {
          display: none !important;
        }
      }
    </style>
    <link rel="icon" type="image/x-icon" href="/logo.png">
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar no-print">
      <div class="navbar-container">
        <a href="#" class="navbar-brand">บริษัท เคเอ็นบี อินเตอร์เนชั่นแนล</a>
        <ul class="navbar-menu">
          <!-- <li><a href="#">หน้าแรก</a></li> -->
          <li><a href="index.html">ใบกำกับภาษี</a></li>
          <li><a href="#">ใบสำคัญการซื้อขาย</a></li>
          <!-- <li><a href="#">ออกจากระบบ</a></li> -->
        </ul>
      </div>
    </nav>
    <br />
    <div class="btn-container no-print">
      <button class="btn" onclick="exportPDF()">ดาวน์โหลด PDF</button>
      <!-- <button class="btn secondary" onclick="addItem()">
        เพิ่มรายการสินค้า
      </button> -->
    </div>

    <div id="invoice" class="invoice-box">
      <div class="header">
        <div class="logo">
          <!-- <div style="width: 100px; height: 100px; background: #eee; display: flex; align-items: center; justify-content: center; border: 1px dashed #ccc;">LOGO</div>-->
          <img src="images/logo.png" alt="Company Logo" />
        </div>
        <div class="company-info">
          <h2 style="color: #0b3b66">บริษัท เคเอ็นบี อินเตอร์เนชั่นแนล จำกัด</h2>
          <h2 style="font-family: sans-serif; font-size: 16px; font-weight: 800;color: #0b3b66;margin-top: -7px;">
    KNB INTERNATIONAL CO., LTD.
</h2>
          <br>
           <p style="margin-top: -22px;font-size: 14px;">
            สำนักงานใหญ่ 72/4 หมู่ 6 ตำบลพนานิคม อำเภอนิคมพัฒนา </br>
            จังหวัด ระยอง 21180 </br>
            เบอร์โทร : 081-256-3627<br />
            สาขา 001 เคเอ็นบี มอเตอร์<br />
            ที่อยู่: 2/97-98 ม.1 ตำบลบางริ้น อำเภอเมืองระนอง <br />
            จังหวัด ระนอง 85000<br />
            เบอร์โทร : 091-026-4177 <br />
            เลขประจำตัวผู้เสียภาษี : 0215565007664
          </p>
        </div>
      </div>

      <div class="title">ใบสำคัญการซื้อขาย</div>

      <div class="info-section">
        <div class="info-group">
          <div class="info-item">
            <strong>ชื่อผู้ขาย:</strong>
            <input
              type="text"
              value="บริษัท เคเอ็นบี อินเตอร์เนชั่นแนล จำกัด"
            />
          </div>
          <div class="info-item">
            <strong>ชื่อผู้ซื้อ:</strong>
            <input type="text" placeholder="ระบุชื่อผู้ซื้อ" />
          </div>
          <div class="info-item">
            <strong>เลขที่บัตร:</strong>
            <input type="text" placeholder="ระบุเลขที่บัตรประชาชน" />
          </div>
          <div class="info-item">
            <strong>ที่อยู่:</strong>
            <textarea rows="5" placeholder="ระบุที่อยู่"></textarea>
          </div>
        </div>
        <div class="info-group">
          <div class="info-item">
            <strong>เลขที่เอกสาร:</strong> <input type="text" id="docNumber" />
          </div>
          <div class="info-item">
            <strong>วันที่:</strong> <input type="date" id="docDate" />
          </div>
          <div class="info-item">
            <strong>ยี่ห้อ/รุ่น:</strong>
            <input type="text" placeholder="เช่น Honda ADV" />
          </div>
          <div class="info-item">
            <strong>เลขตัวถัง:</strong>
            <input type="text" placeholder="ระบุเลขตัวถัง" />
          </div>
          <div class="info-item">
            <strong>เลขเครื่อง:</strong>
            <input type="text" placeholder="ระบุเลขเครื่อง" />
          </div>
          <div class="info-item">
            <strong>เลขทะเบียน:</strong>
            <input type="text" placeholder="ระบุเลขทะเบียน" />
          </div>
          <div class="info-item">
            <strong>ประเภทรถ:</strong>
            <select id="carsType" name="carsType" class="dropdownS">
              <option value="new">รถใหม่</option>
              <option value="old">รถมือสอง</option>
            </select>
          </div>
        </div>
      </div>

      <div class="payment-section">
        <strong>รูปแบบการชำระเงิน:</strong>
        <div class="payment-methods no-print">
          <label
            ><input
              type="radio"
              name="payMethod"
              value="cash"
              checked
              onchange="togglePaymentDetails()"
            />
            เงินสด</label
          >
          <label
            ><input
              type="radio"
              name="payMethod"
              value="installment"
              onchange="togglePaymentDetails()"
            />
            ผ่อน</label
          >
          <label
            ><input
              type="radio"
              name="payMethod"
              value="cheque"
              onchange="togglePaymentDetails()"
            />
            เช็ค</label
          >
          <label
            ><input
              type="radio"
              name="payMethod"
              value="transfer"
              onchange="togglePaymentDetails()"
            />
            โอนเงิน</label
          >
        </div>

        <div id="cash-details" class="payment-details active">
          <p>ชำระด้วยเงินสด</p>
        </div>
        <div id="installment-details" class="payment-details">
          <p>ชำระด้วยเงินผ่อน โดย :</p>
          <input type="text" placeholder="ระบุชื่อไฟแนนซ์" style="width: 50%" />
        </div>

        <div id="transfer-details" class="payment-details">
          <div class="payment-row">
            <label>ธนาคาร:</label>
            <input type="text" placeholder="ระบุชื่อธนาคาร" />
            <label>เลขที่บัญชี:</label>
            <input type="text" placeholder="ระบุเลขที่บัญชี" />
          </div>
          <div class="payment-row">
            <label>วันที่โอน:</label> <input type="date" />
          </div>
        </div>

        <div id="cheque-details" class="payment-details">
          <div class="payment-row">
            <label>ธนาคาร:</label>
            <input type="text" placeholder="ระบุชื่อธนาคาร" />
            <label>เลขที่เช็ค:</label>
            <input type="text" placeholder="ระบุเลขที่เช็ค" />
          </div>
          <div class="payment-row">
            <label>ลงวันที่:</label> <input type="date" />
          </div>
        </div>
      </div>

      <div style="margin-top: 20px">
        <strong>หมายเหตุ:</strong>
        <textarea rows="5" placeholder="ระบุหมายเหตุเพิ่มเติม"></textarea>
      </div>
      <br />
      <br />
      <strong
        >ผู้ซื้อได้ตรวจเช็คสภาพรถและเครื่องยนต์เป็นที่เรียบร้อยแล้ว</strong
      >
      <div class="footer">
        <div class="signature">
          <div class="signature-line">ลงชื่อผู้ซื้อ</div>
        </div>
        <div class="signature">
          <div class="signature-line">ลงชื่อผู้ขาย / ผู้รับเงิน</div>
        </div>
        <div class="signature">
          <div class="signature-line">พยาน</div>
        </div>
      </div>
    </div>

    <script>
      // ตั้งค่าวันที่และเลขที่เอกสารเริ่มต้น
      const today = new Date();
      document.getElementById("docDate").valueAsDate = today;
      const dateStr =
        today.getFullYear().toString() +
        (today.getMonth() + 1).toString().padStart(2, "0") +
        today.getDate().toString().padStart(2, "0");
      document.getElementById("docNumber").value = `INV-${dateStr}-001`;

      function togglePaymentDetails() {
        const method = document.querySelector(
          'input[name="payMethod"]:checked',
        ).value;

        document
          .querySelectorAll(".payment-details")
          .forEach((el) => el.classList.remove("active"));
        document.getElementById(`${method}-details`).classList.add("active");
      }

      function exportPDF() {
        const element = document.getElementById("invoice");
        const opt = {
          margin: 10,
          filename: `Invoice-${document.getElementById("docNumber").value}.pdf`,
          image: { type: "jpeg", quality: 0.98 },
          html2canvas: { scale: 2, useCORS: true },
          jsPDF: { unit: "mm", format: "a4", orientation: "portrait" },
        };

        element.classList.add("export-mode");

        // สร้างคอนเทนเนอร์สำหรับ 2 สำเนา
        const pdfContainer = document.createElement("div");
        pdfContainer.id = "pdf-export-container";

        for (let copy = 0; copy < 2; copy++) {
          const clonedElement = element.cloneNode(true);
          clonedElement.classList.add("export-mode");

          // จัดการค่าป้ายกำกับ
          const copyLabel = document.createElement("div");
          copyLabel.style.cssText = "text-align: right; padding: 5px; font-size: 12px; color: #999; margin-bottom: 5px;";
          copyLabel.innerText = copy === 0 ? "ต้นฉบับ (Original)" : "สำเนา (Copy)";

          const wrapper = document.createElement("div");
          wrapper.style.cssText = "page-break-after: always; padding-bottom: 20px;";
          wrapper.appendChild(copyLabel);
          wrapper.appendChild(clonedElement);
          pdfContainer.appendChild(wrapper);

          // --- ส่วนที่แก้ไข: ดึงค่าจาก Form จริงไปใส่ในชุดที่ Clone ---
          const originalInputs = element.querySelectorAll("input, textarea, select");
          const clonedInputs = clonedElement.querySelectorAll("input, textarea, select");

          originalInputs.forEach((orig, index) => {
            const cloned = clonedInputs[index];
            if (orig.tagName === "SELECT") {
              // ดึงข้อความที่เลือก (เช่น "รถมือสอง") แทนที่จะเอาแค่ value
              const selectedText = orig.options[orig.selectedIndex].text;
              const span = document.createElement("span");
              span.innerText = selectedText;
              cloned.parentNode.replaceChild(span, cloned);
            } else if (orig.type !== "radio") {
              // สำหรับ input text และ textarea
              const span = document.createElement("span");
              span.innerText = orig.value;
              cloned.parentNode.replaceChild(span, cloned);
            }
          });
        }

        document.body.appendChild(pdfContainer);

        html2pdf()
          .set(opt)
          .from(pdfContainer)
          .save()
          .then(() => {
            element.classList.remove("export-mode");
            pdfContainer.remove();
          });
      }

      addItem();
    </script>
  </body>
</html>
